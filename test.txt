-------------------------------------------------------------------------------
-- Script name:   AVSA_VAR_EPG_Master.hql
-- Created on:    10/11/2015
-- Author:        Geetha Nair, Parvathy
-- Purpose:       Process to load the dimensions in order to simplify calculation of KPI
-------------------------------------------------------------------------------

-- creation of staging table for var_epg_master
CREATE EXTERNAL TABLE IF NOT EXISTS var_epg_master (
    content_id 		STRING,
	program_title 	STRING,
	channel         STRING,
	duration_min 	DOUBLE
)
ROW FORMAT
DELIMITED FIELDS TERMINATED BY '\073'
LINES TERMINATED BY '\n'
STORED AS TEXTFILE
LOCATION '${hivevar:root_path}/agg/VAR_EPG/var_epg_master';

-- Process to load the dimensions in order to simplify calculation of KPI
INSERT INTO TABLE var_epg_master
SELECT 
       t1.livecontentid                      AS content_id,
	   t1.title                              AS program_title,
	   t1.channel_name                       AS channel,
	   ( IF(1 == 2, 1, NULL) )               AS duration_min
	   FROM   target_epg_catalog t1;
