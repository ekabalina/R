-------------------------------------------------------------------------------
-- Script name:   AVSA_VAR_VOD_Master.hql
-- Created on:    10/11/2015
-- Author:        Geetha Nair, Parvathy
-- Purpose:       Process to load the dimensions in order to simplify calculation of KPI
-------------------------------------------------------------------------------

-- creation of  table for var_vod_master
CREATE EXTERNAL TABLE IF NOT EXISTS var_vod_master (
  content_id STRING,
  title STRING,
  genre STRING,
  category STRING,
  duration_min DOUBLE,
  attribute_1 STRING,
  attribute_2 STRING,
  attribute_3 STRING,
  attribute_4 STRING,
  attribute_5 STRING,
  attribute_6 STRING,
  attribute_7 STRING,
  attribute_8 STRING,
  attribute_9 STRING,
  attribute_10 STRING,
  attribute_11 STRING,
  attribute_12 STRING,
  attribute_13 STRING,
  attribute_14 STRING,
  attribute_15 STRING,
  attribute_16 STRING,
  attribute_17 STRING,
  attribute_18 STRING,
  attribute_19 STRING,
  attribute_20 STRING
)
ROW FORMAT
DELIMITED FIELDS TERMINATED BY '\073'
LINES TERMINATED BY '\n'
STORED AS TEXTFILE
LOCATION '${hivevar:root_path}/agg/VAR_VOD/var_vod_master';

-- Process to load the dimensions in order to simplify calculation of KPI
INSERT INTO TABLE var_vod_master
SELECT 
  t1.contentid       AS content_id,
  t1.title           AS program_title,
  t1.genre           AS genre,
  t1.categoryname    AS category,
  t1.contentduration AS duration_min,
  t2.attribute_1     AS attribute_1,
  t2.attribute_2     AS attribute_2,
  t2.attribute_3     AS attribute_3,
  t2.attribute_4     AS attribute_4,
  t2.attribute_5     AS attribute_5,
  t2.attribute_6     AS attribute_6,
  t2.attribute_7     AS attribute_7,
  t2.attribute_8     AS attribute_8,
  t2.attribute_9     AS attribute_9,
  t2.attribute_10    AS attribute_10,
  t2.attribute_11    AS attribute_11,
  t2.attribute_12    AS attribute_12,
  t2.attribute_13    AS attribute_13,
  t2.attribute_14    AS attribute_14,
  t2.attribute_15    AS attribute_15,
  t2.attribute_16    AS attribute_16,
  t2.attribute_17    AS attribute_17,
  t2.attribute_18    AS attribute_18,
  t2.attribute_19    AS attribute_19,
  t2.attribute_20    AS attribute_20   
FROM   target_category_map t1
       LEFT OUTER JOIN target_content_custom_attributes t2 
                    ON ( t1.contentid = t2.contentid );
